; Listing generated by Microsoft (R) Optimizing Compiler Version 17.00.51106.1 

	TITLE	C:\Users\Zhitao Li\Documents\Visual Studio 2012\Projects\Freefalcon\FALCLIB\FileMap.cpp
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	?map_file@@YAPAXPADJ@Z				; map_file
EXTRN	__imp__CreateFileA@28:PROC
EXTRN	__imp__MapViewOfFileEx@24:PROC
EXTRN	__imp__CreateFileMappingA@24:PROC
; Function compile flags: /Odtp
; File c:\users\zhitao li\documents\visual studio 2012\projects\freefalcon\falclib\filemap.cpp
_TEXT	SEGMENT
_address$ = -12						; size = 4
_map$ = -8						; size = 4
_file$ = -4						; size = 4
_filename$ = 8						; size = 4
_bytestomap$ = 12					; size = 4
?map_file@@YAPAXPADJ@Z PROC				; map_file

; 8    : {

	push	ebp
	mov	ebp, esp
	sub	esp, 12					; 0000000cH

; 9    : 	HANDLE
; 10   : 		file,
; 11   : 		map;
; 12   : 
; 13   : 	void
; 14   : 		*address;
; 15   : 
; 16   : 	file = CreateFile
; 17   : 	(
; 18   : 		filename,
; 19   : 		GENERIC_READ,
; 20   : 		FILE_SHARE_READ,
; 21   : 		NULL,
; 22   : 		OPEN_EXISTING,
; 23   : 		FILE_ATTRIBUTE_NORMAL,
; 24   : 		NULL
; 25   : 	);

	push	0
	push	128					; 00000080H
	push	3
	push	0
	push	1
	push	-2147483648				; 80000000H
	mov	eax, DWORD PTR _filename$[ebp]
	push	eax
	call	DWORD PTR __imp__CreateFileA@28
	mov	DWORD PTR _file$[ebp], eax

; 26   : 
; 27   : 	if (file == INVALID_HANDLE_VALUE)

	cmp	DWORD PTR _file$[ebp], -1
	jne	SHORT $LN2@map_file

; 28   : 	{
; 29   : 		return NULL;

	xor	eax, eax
	jmp	SHORT $LN3@map_file
$LN2@map_file:

; 30   : 	}
; 31   : 
; 32   : 	map = CreateFileMapping
; 33   : 	(
; 34   : 		file,
; 35   : 		NULL,
; 36   : 		PAGE_READONLY | SEC_COMMIT,
; 37   : 		0,
; 38   : 		0,
; 39   : 		NULL
; 40   : 	);

	push	0
	push	0
	push	0
	push	134217730				; 08000002H
	push	0
	mov	ecx, DWORD PTR _file$[ebp]
	push	ecx
	call	DWORD PTR __imp__CreateFileMappingA@24
	mov	DWORD PTR _map$[ebp], eax

; 41   : 
; 42   : 	if (map == NULL)

	cmp	DWORD PTR _map$[ebp], 0
	jne	SHORT $LN1@map_file

; 43   : 	{
; 44   : 		return NULL;

	xor	eax, eax
	jmp	SHORT $LN3@map_file
$LN1@map_file:

; 45   : 	}
; 46   : 
; 47   : 	address = MapViewOfFileEx
; 48   : 	(
; 49   : 		map,
; 50   : 		FILE_MAP_READ,
; 51   : 		0,
; 52   : 		0,
; 53   : 		bytestomap,
; 54   : 		NULL
; 55   : 	);

	push	0
	mov	edx, DWORD PTR _bytestomap$[ebp]
	push	edx
	push	0
	push	0
	push	4
	mov	eax, DWORD PTR _map$[ebp]
	push	eax
	call	DWORD PTR __imp__MapViewOfFileEx@24
	mov	DWORD PTR _address$[ebp], eax

; 56   : 
; 57   : 	return address;

	mov	eax, DWORD PTR _address$[ebp]
$LN3@map_file:

; 58   : }

	mov	esp, ebp
	pop	ebp
	ret	0
?map_file@@YAPAXPADJ@Z ENDP				; map_file
_TEXT	ENDS
END
